<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
  Reconstructing spatial fluctuations of the galactic dust amplitude.
  </title>

  <link rel="stylesheet" href="styles.css">

    <!-- MathJax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <!-- MathJax equation numbering -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>


</head>

  <body>
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

  <div class="container content">

      <main>
        <article class="page">
  <h1 id='top' class="page-title"> Reconstructing $A_{\rm dust}$ fluctuations </h1>
  <p class="page-author"> F. Bianchini + D. Beck</p>
  <p class="page-date"> 7 June 2021. </p>

<h2>Outline and scope</h2>

<p>
In this posting we'll try to reconstruct the fluctuations of the Galactic dust amplitude $A_d$ using a quadratic estimator (QE) formalism.
</p>
<p>
The starting point is that Galactic dust emission at high and intermediate galactic latitudes is usually described as a random Gaussian field with
a power-law power spectrum $C_{\ell}=A_{d}\left(\frac{\ell}{80}\right)^{\alpha_{d}}$. 
However, the brightness of the Galactic dust is known to vary across the sky. 
Renormalizing the amplitude w.r.t. the mean, we can write the observed dust Stokes parameters as 
$\tilde{Q} \pm i \tilde{U}=\sqrt{1+\delta A_{d}(\mathbf{n})}(Q(\mathbf{n}) \pm i U(\mathbf{n}))\approx\left(1+\frac{\delta
A_{d}(\mathbf{n})}{2}\right)(Q(\mathbf{n}) \pm i U(\mathbf{n}))$ (and similarly for temperature).
</p>
<p>
If we look at the previous equation we can notice that it resembles the screening effect of the primary CMB anisotropies due to the optical depth fluctuations 
(where we have $\tilde{Q} \pm i \tilde{U} \approx\left(1-\tau(\mathbf{n})\right)(Q(\mathbf{n}) \pm i U(\mathbf{n}))$). 
Then, it makes sense to apply the QE estimator that looks for modulations in the CMB maps (i.e. patchy-$\tau$) to the Galactic dust maps that can be produced by component separation algorithms. 
</p>

<hr>

<h2>Map/masks plot pager</h2>
    <p>
    We generate two sets of $N_{\rm sims}=300$ realizations of Galactic dust:
    <ul>
    <li>Gaussian sims @ 353 GHz using $A_d=4.25\mu$K$^2$, $\alpha_d=-0.4$, and $E$-to-$B$=2 (we scale these maps to other freqs using the formalism outlined in the Appendix of this <a href='https://arxiv.org/pdf/2008.12619.pdf'>CMB-S4 paper</a>)</li>
    <li>Gaussian sims from the point above that have been modulated using a <i>fixed</i> template map loosely constructed following the scheme sketched <a href="https://cmb-s4.uchicago.edu/wiki/index.php/Amplitude_modulated_Gaussian_dust_sims">here</a> (the modulation map basically contains the dust amplitude at $\ell=80$ of power-law fits to the BB spectra in 400 sq deg circular patches taken from Planck's <code>NPIPE</code> 353 GHz map)</li>
    </ul>
    </p>

    <p>
    We analyze these maps in two scenarios
    <ul>
    <li>Ideal case: no beam or noise is applied to the maps</li>
    <li>(more) Realistic case: we apply a Gaussian beam and add homogeneous white noise. For 150 GHz (the freq we consider here) the numbers are $\theta_{\rm FWHM}=20$ arcmin and $\Delta_T=\Delta_P/\sqrt{2}=5\mu$K-arcmin </li>
    </ul>
    For both cases we apply the B3 and Keck masks.
    Of course, the auto-spectrum of the QE estimate in the first is expected to be consistent with zero for the simple Gaussian sims while that should not be the case for the amplitude modulated ones. 
    </p>

    <figure>
    <img alt="Maps pager" id="maps_pager" src="#" />
    <figcaption>
    Plots of the different dust simulations (showing here #rlz=0) and masks used in the analysis.
    </figcaption>
        <script type="text/javascript">
            pager.link("#maps_pager",
                {
                    'Frequency |freq01': ['150'],
                    'Stokes parameter|stoke01': ['T', 'Q', 'U', 'mask_keck', 'mask_B3'],
                    'Dust type|dusttype01': ['Gaussian dust sims|gauss', 'Amp mod gauss|ampmod', 'Gaussian dust varbeta sims|gauss_varbeta', 'Amp mod gauss varbeta|ampmod_varbeta'],
                    'Sim type|simtype01': ['Ideal sims|ideal', 'Beam+noise|beamnoise',],
                },
                function(params) {
                    return 'plots/maps_'+params['freq01']+'/' +params['stoke01']+ '_'+ params['dusttype01']+ '_'+params['simtype01']+'.png';
                });
                pager.setparams({
                    'freq01': '150',
                    'stoke01':'T',
                    'dusttype01': 'gauss',
                    'simtype01': 'ideal',
                });
    </script>
    </figure>

<hr>

<h2> Modulation QE maps and spectra pagers </h2>

    <p>
    We reconstruct the spatial fluctuations of the dust amplitude <a href="https://github.com/carronj/plancklens/"><code>plancklens</code></a> that implements the modulation QE in the curved-sky framework.
    We use 60 maps to estimate the mean-field bias. Note that in the amplitude modulated case we use the mean-field estimated from the simple gaussian case.  
    In all cases we remove the $N0$ bias estimated from <i>gaussian</i> sims. 
    </p>

    <p>
    Some QE reconstruction params:
    <ul>
        <li>$\ell_{\rm min, CMB} = 100$ minimum CMB input multipole</li>
        <li>$\ell_{\rm max, CMB} = 1024$ maximum CMB input multipole</li>
        <li>$N_{\rm side} = 512$ healpix map resolution</li>
    </ul>
    </p>

    <figure>
        <img alt="QE pager" id="qe_pager" src="#" />
        <figcaption>
            Plots of the raw QE estimate, the mean-field debiased one, and the mean-field itself (showing here #rlz=150).
        </figcaption>
        <script type="text/javascript">
            pager.link("#qe_pager",
                {
                    'Frequency |freqqe': ['150'],
                    'Map Type |maptypeqe': ['Raw (single-rlz)|qe','Mean-field debiased (single-rlz) |qe_mf', 'Mean-field debiased (averaged over rlz)|qe_mf_avg', 'Mean-field|mf', 'Modulation map|modmap'],
                    'Estimator |estqe': ['T', 'P', 'MV',],
                    'Mask |maskqe': ['B3','Keck'],
                    'Dust type|dusttypeqe': ['Gaussian dust sims|gauss', 'Amp mod gauss|ampmod', 'Gaussian dust varbeta sims|gauss_varbeta', 'Amp mod gauss varbeta|ampmod_varbeta'],
                    'Sim type|simtypeqe': ['Ideal sims|ideal', 'Beam+noise|beamnoise',],
                    'Proj|projqe': ['Curved-sky|full', 'Flat-sky|flat',],
                },
                function (params) {
                    return 'plots/maps_' + params['freqqe'] + '/' + params['maptypeqe'] + '_' + params['estqe'] + '_' + params['maskqe'] + '_' + params['simtypeqe'] + '_' + params['dusttypeqe'] + '_' + params['projqe'] + '.png';
                });
            pager.setparams({
                'freqqe': '150',
                'maptypeqe': 'qe',
                'estqe': 'T',
                'maskqe': 'B3',
                'dusttypeqe': 'gauss',
                'simtypqe': 'ideal',
                'projqe': 'flat',
            });
        </script>
    </figure>

    <figure>
    <img alt="1d pager" id="oned_pager" src="#" />
    <figcaption>
    N0 debiased power spectra. Note that these spectra have been averaged over 240 sims, therefore the statistical uncertainties are divided by $\sqrt{N_{\rm sims}}$, they're not per single rlz.
    Note that the N1 bias term which is expected to be presente in the <i>case</i> has <b>not</b> been subtracted.
    </figcaption>
        <script type="text/javascript">
            pager.link("#oned_pager",
                {
                    'Dust type|dusttype02': ['Gaussian dust sims|gauss', 'Amp mod gauss|ampmod', 'Gaussian dust varbeta sims|gauss_varbeta', 'Amp mod gauss varbeta|ampmod_varbeta'],
                    'Sim type|simtype02': ['Ideal sims|ideal', 'Beam+noise|beamnoise',],
                    'Frequency |freq02': ['150'],
                    'Mask |mask02': ['B3','Keck'],
                    'Estimator |est02': ['T', 'P', 'MV'],
                    'Bins |bins02': ['agr2', 'linear'],
                    'N0 |n002': ['mc',],
                    'Axes |ax02': ['lin', 'log']
                },
                function(params) {
                   return 'plots/autos/cldada_' + params['est02'] + '_' + params['freq02'] + '_' + params['mask02'] + '_'+ params['simtype02'] + '_' + params['dusttype02'] + '_' + params['bins02'] + '_' + params['n002'] + '_' + params['ax02'] + '.png';

                });
                pager.setparams({
                    'dusttype02': 'gauss',
                    'simtype02': 'ideal',
                    'freq02': '150',
                    'mask02':'B3',
                    'bins02':'agr2',
                    'est02':'T',
                    'n002': 'mc',
                    'ax02': 'lin',
                });
    </script>
    </figure>

<hr>

<h2> Correlation matrix pagers </h2>

<figure>
    <img alt="corr pager" id="corr_pager" src="#" />
    <figcaption>
        Correlation matrices.
    </figcaption>
    <script type="text/javascript">
        pager.link("#corr_pager",
            {
                'Dust type|dusttype03': ['Gaussian dust sims|gauss', 'Amp mod gauss|ampmod', 'Gaussian dust varbeta sims|gauss_varbeta', 'Amp mod gauss varbeta|ampmod_varbeta'],
                'Sim type|simtype03': ['Ideal sims|ideal', 'Beam+noise|beamnoise',],
                'Frequency |freq03': ['150'],
                'Mask |mask03': ['B3', 'Keck'],
                'Estimator |est03': ['T', 'P', 'MV'],
                'Debiasing |covtype': ['N0|mcn0','RDN0|nhl'],
                'Bins |bins03': ['agr2', 'linear'],
            },
            function (params) {
                return 'plots/corrs/corr_' + params['covtype'] + '_' + params['est03'] + '_' + params['freq03'] + '_' + params['mask03'] + '_' + params['simtype03'] + '_' + params['dusttype03'] + '_' + params['bins03'] + '.png';
            });
        pager.setparams({
            'dusttype': 'gauss',
            'simtype': 'ideal',
            'freq03': '150',
            'mask03': 'B3',
            'est03': 'T',
            'bins03': 'agr2',
            'covtype':'mcn0',
        });
    </script>
</figure>

<hr>

<h2> N0 pagers </h2>

    <figure>
    <img alt="n0 pager" id="n0_pager" src="#" />
    <figcaption>
    Comparison between the realization-dependent/independent N0 bias estimates.
    </figcaption>
    <script type="text/javascript">
        pager.link("#n0_pager",
            {
                'Dust type|dusttype04': ['Gaussian dust sims|gauss', 'Amp mod gauss|ampmod', 'Gaussian dust varbeta sims|gauss_varbeta', 'Amp mod gauss varbeta|ampmod_varbeta'],
                'Sim type|simtype04': ['Ideal sims|ideal', 'Beam+noise|beamnoise',],
                'Frequency |freq04': ['150'],
                'Mask |mask04': ['B3', 'Keck'],
                'Estimator |est04': ['T', 'P', 'MV'],
                'N0 type |n0type': ['RDN0|rdn0', 'N0|mcn0'],
                'Bins |bins04': ['agr2', 'linear'],
            },
            function (params) {
                return 'plots/'+params['n0type'] + '/' + params['n0type'] + '_' + params['est04'] + '_' + params['freq04'] + '_' + params['mask04'] + '_' + params['simtype04'] + '_' + params['dusttype04'] + '_' + params['bins04'] + '.png';
            });
        pager.setparams({
            'dusttype04': 'gauss',
            'simtype04': 'ideal',
            'freq04': '150',
            'mask04': 'B3',
            'bins04': 'agr2',
            'est04': 'T',
            'n0type': 'rdn0',
        });
    </script>
    </figure>

<hr>

<h2>Conclusions</h2>

    There are still many things to check and possible extensions:
    <ul>
        <li>calculating the cross-spectrum between input modulation map and reconstructed maps</li>
        <li>using more sophisticated dust model, like Vansyngel</li>
    </ul>

<hr>

</article>
</main>
</div>
<script type="text/javascript">
    plupdate();
</script>
</body>
</html>
